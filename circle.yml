machine:
  services:
    - docker
  environment:
    GOPATH: /home/ubuntu
    PATH: $PATH:$HOME/.local/bin

dependencies:
  cache_directories:
    - "~/docker"
  post:
    # Cache the build image
    - |
        cd common-build && \
        ../tools/rebuild-image weaveworks/common-build . build.sh Dockerfile && \
        touch .uptodate
    # Get the dependencies
    - go get -u github.com/golang/dep/cmd/dep && dep ensure

test:
  override:
    - make RM= lint
    - make RM= test
